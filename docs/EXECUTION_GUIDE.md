# ESG ë¦¬í¬íŠ¸ ì¶”ì¶œ íŒŒì´í”„ë¼ì¸ ì‹¤í–‰ ê°€ì´ë“œ

ì´ ë¬¸ì„œëŠ” ESG PDF íŒŒì´í”„ë¼ì¸ì˜ **ì‹¤í–‰ ëª…ë ¹ì–´(Command)**ë¥¼ ìƒì„¸í•˜ê²Œ ë‹¤ë£¹ë‹ˆë‹¤.
ì£¼ë¡œ ì‚¬ìš©ë˜ëŠ” **ì „ì²´ íŒŒì´í”„ë¼ì¸ ì‹¤í–‰(`run_pipeline.py`)**ê³¼ **DB ì ì¬(`load_to_db.py`)**ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ì„¤ëª…í•©ë‹ˆë‹¤.

---

## ğŸš€ 1. ì „ì²´ íŒŒì´í”„ë¼ì¸ ì‹¤í–‰ (ê¶Œì¥)
ìŠ¤í¬ë¦½íŠ¸ í•˜ë‚˜ë¡œ **[PDF ë³µêµ¬ -> êµ¬ì¡°í™” -> OCR -> GPT ë¶„ì„ -> DB ì ì¬]** ëª¨ë“  ê³¼ì •ì„ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰í•©ë‹ˆë‹¤.

**ê¸°ë³¸ ëª…ë ¹ì–´ í¬ë§·:**
```bash
python src/run_pipeline.py --pdf [PDFíŒŒì¼ê²½ë¡œ] [ì˜µì…˜...]
```

### âœ… Scenario A: í‘œì¤€ ì‹¤í–‰ (ê°€ì¥ ë§ì´ ì‚¬ìš©)
íŠ¹ì • ë³´ê³ ì„œì˜ ì¼ë¶€ í˜ì´ì§€(ì˜ˆ: 1~20í˜ì´ì§€)ë¥¼ ì²˜ë¦¬í•˜ê³  DBì— ì €ì¥í•©ë‹ˆë‹¤.
```bash
python src/run_pipeline.py \
    --pdf data/input/2023_HDEC_Report.pdf \
    --pages 1-20 \
    --load-db
```
- **íŠ¹ì§•**: PDF ì¸ì½”ë”© ë¬¸ì œ ìë™ ê°ì§€, GPT ê·¸ë¦¼ ì„¤ëª… ìƒì„±, DB ìë™ ì ì¬.

### âœ… Scenario B: ì „ì²´ í˜ì´ì§€ ì‹¤í–‰
`--pages` ì˜µì…˜ì„ ìƒëµí•˜ë©´ PDF ì „ì²´ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤. (**ì‹œê°„ê³¼ ë¹„ìš© ì£¼ì˜**)
```bash
python src/run_pipeline.py \
    --pdf data/input/2023_HDEC_Report.pdf \
    --load-db
```

### âœ… Scenario C: ë¹„ìš© ì ˆê° ì‹¤í–‰ (GPT ìƒëµ)
GPT API ë¹„ìš©ì´ ê±±ì •ë˜ê±°ë‚˜ ê·¸ë¦¼ ì„¤ëª…ì´ í•„ìš” ì—†ëŠ” ê²½ìš° `--skip-gpt`ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
```bash
python src/run_pipeline.py \
    --pdf data/input/2023_HDEC_Report.pdf \
    --pages 1-50 \
    --skip-gpt \
    --load-db
```

### âœ… Scenario D: DB ì´ˆê¸°í™” í›„ ì‹¤í–‰ (ì£¼ì˜: ë°ì´í„° ì‚­ì œ)
DB ìŠ¤í‚¤ë§ˆë¥¼ ìƒˆë¡œ ê³ ì¹˜ê³  ì²˜ìŒë¶€í„° ìŒ“ê³  ì‹¶ì„ ë•Œ `--init-db`ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
*ê¸°ì¡´ ë°ì´í„°ê°€ ëª¨ë‘ ì‚­ì œë˜ë¯€ë¡œ ì£¼ì˜í•˜ì„¸ìš”.*
```bash
python src/run_pipeline.py \
    --pdf data/input/2023_HDEC_Report.pdf \
    --pages 1-10 \
    --load-db \
    --init-db
```

---

## ğŸ’¾ 2. DB ì ì¬ ì „ìš© ì‹¤í–‰
ì´ë¯¸ ë°ì´í„° ì¶”ì¶œ(`structured_extract`, `ocr` ë“±)ì€ ì™„ë£Œë˜ì—ˆê³ , **ë°ì´í„°ë² ì´ìŠ¤ì—ë§Œ ë‹¤ì‹œ ë„£ê³  ì‹¶ì„ ë•Œ** ì‚¬ìš©í•©ë‹ˆë‹¤.
ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” **ì§€ì •ëœ ë³´ê³ ì„œ í´ë”ì˜ ëª¨ë“  ë°ì´í„°**ë¥¼ ë¡œë“œí•©ë‹ˆë‹¤. (í˜ì´ì§€ ë²”ìœ„ ì§€ì • ë¶ˆê°€)

**ê¸°ë³¸ ëª…ë ¹ì–´ í¬ë§·:**
```bash
python src/load_to_db.py --doc-name [ë¬¸ì„œëª…] [ì˜µì…˜...]
```

### âœ… Scenario A: ë°ì´í„° ì ì¬ (ì—…ë°ì´íŠ¸ ëª¨ë“œ)
ê¸°ì¡´ì— DBì— ë°ì´í„°ê°€ ìˆë‹¤ë©´ ì—…ë°ì´íŠ¸í•˜ê³ , ì—†ìœ¼ë©´ ìƒˆë¡œ ì¶”ê°€í•©ë‹ˆë‹¤. (`UPSERT` ë™ì‘)
```bash
# íŒŒì¼ëª…(í™•ì¥ì ì œì™¸) ë˜ëŠ” ì§€ì •í•œ doc-nameì„ ì…ë ¥
python src/load_to_db.py --doc-name "2023_HDEC_Report"
```
*ì°¸ê³ : ë¬¸ì„œëª…ì€ `data/pages_structured/` ì•„ë˜ì— ìˆëŠ” í´ë”ëª…ê³¼ ì¼ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤.*

### âœ… Scenario B: DB ì´ˆê¸°í™” ë° ì¬ì ì¬
ìŠ¤í‚¤ë§ˆê°€ ë³€ê²½ë˜ì—ˆê±°ë‚˜ ê¹¨ë—í•œ ìƒíƒœì—ì„œ ë‹¤ì‹œ ì‹œì‘í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.
```bash
python src/load_to_db.py --doc-name "2023_HDEC_Report" --init-db
```

---

## ğŸ›  3. ë‹¨ê³„ë³„ ê°œë³„ ì‹¤í–‰ (ë””ë²„ê¹…)
íŒŒì´í”„ë¼ì¸ì˜ íŠ¹ì • ë‹¨ê³„ì—ì„œ ë¬¸ì œê°€ ë°œìƒí–ˆê±°ë‚˜, í•œ ë‹¨ê³„ë§Œ í…ŒìŠ¤íŠ¸í•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.

**Step 0: PDF Sanitization (ë³µêµ¬)**
```bash
# ë³µêµ¬ê°€ í•„ìš”í•œì§€ ê²€ì‚¬í•˜ê³ , í•„ìš”í•˜ë©´ .sanitized.pdf ìƒì„±
python src/pdf_text_extractor.py --pdf data/input/broken.pdf
```

**Step 1: êµ¬ì¡°í™” (Docling)**
```bash
# í…ìŠ¤íŠ¸, í‘œ, ê·¸ë¦¼ ì¶”ì¶œ (ê°€ì¥ ì˜¤ë˜ ê±¸ë¦¼)
python src/structured_extract.py --pdf data/input/report.pdf --pages 10-15
```

**Step 2: í‘œ OCR (RapidOCR)**
```bash
# ì´ë¯¸ì§€ ê¸°ë°˜ í‘œ í…ìŠ¤íŠ¸ ì¬ì¶”ì¶œ
python src/table_ocr.py \
    --structured-dir data/pages_structured/2023_HDEC_Report \
    --pages 10-15
```

**Step 3: ê·¸ë¦¼ ì„¤ëª… (GPT-4o)**
```bash
# ì°¨íŠ¸/ë‹¤ì´ì–´ê·¸ë¨ í•´ì„
python src/figure_ocr.py \
    --structured-dir data/pages_structured/2023_HDEC_Report \
    --pages 10-15
```

**Step 4: í‘œ ê²€ì¦ (Diff)**
```bash
# Docling ê²°ê³¼ì™€ OCR ê²°ê³¼ ë¹„êµ
python src/table_diff.py \
    --structured-dir data/pages_structured/2023_HDEC_Report \
    --pages 10-15
```

---

## ğŸ· ì˜µì…˜/íƒœê·¸(Flag) ì°¸ì¡°í‘œ

### `run_pipeline.py` ì˜µì…˜
| ì˜µì…˜(Flag) | í•„ìˆ˜ ì—¬ë¶€ | ì„¤ëª… | ê¸°ë³¸ê°’ |
| :--- | :---: | :--- | :--- |
| `--pdf` | **í•„ìˆ˜** | ì›ë³¸ PDF íŒŒì¼ ê²½ë¡œ (ì˜ˆ: `data/input/report.pdf`) | - |
| `--pages` | ì„ íƒ | ì²˜ë¦¬í•  í˜ì´ì§€ ë²”ìœ„ (ì˜ˆ: `1-10`, `5,10,15`). ìƒëµ ì‹œ ì „ì²´. | ì „ì²´ |
| `--load-db` | ì„ íƒ | ì²˜ë¦¬ ì™„ë£Œ í›„ DB ì ì¬ ìˆ˜í–‰ ì—¬ë¶€ | False |
| `--init-db` | ì„ íƒ | DB ì ì¬ ì „ í…Œì´ë¸” ì´ˆê¸°í™”(DROP & CREATE) ìˆ˜í–‰ ì—¬ë¶€ | False |
| `--skip-gpt` | ì„ íƒ | ê·¸ë¦¼ ì„¤ëª…(Figure Description) ë‹¨ê³„ ìƒëµ (ë¹„ìš© ì ˆê°) | False |
| `--skip-sanitize` | ì„ íƒ | PDF ì¸ì½”ë”© ë³´ì • ë‹¨ê³„ ë¬´ì¡°ê±´ ê±´ë„ˆë›°ê¸° | False |
| `--doc-name` | ì„ íƒ | DB/í´ë”ì— ì‚¬ìš©í•  ë¬¸ì„œ ì‹ë³„ì. ìƒëµ ì‹œ íŒŒì¼ëª… ì‚¬ìš©. | íŒŒì¼ëª… |

### `load_to_db.py` ì˜µì…˜
| ì˜µì…˜(Flag) | í•„ìˆ˜ ì—¬ë¶€ | ì„¤ëª… | ê¸°ë³¸ê°’ |
| :--- | :---: | :--- | :--- |
| `--doc-name` | **í•„ìˆ˜** | ëŒ€ìƒ ë¬¸ì„œëª… (í´ë”ëª…ê³¼ ì¼ì¹˜í•´ì•¼ í•¨) | - |
| `--init-db` | ì„ íƒ | í…Œì´ë¸” ì´ˆê¸°í™” ìˆ˜í–‰ ì—¬ë¶€ | False |
| `--input-dir` | ì„ íƒ | `pages_structured` ìƒìœ„ ê²½ë¡œ ì§€ì • (ë³´í†µ ë³€ê²½ ë¶ˆí•„ìš”) | `data/pages_structured` |
